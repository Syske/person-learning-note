# 初探NIO

### 是什么

NIO（Non-Blocking I/O,java中,也称为New I/O），是一种同步非阻塞的I/O模型，也是I/O多路复用的基础，已经被越来越多地应用到大型应用服务器,是解决高并发、I/O处理问题的有效方式。

### 传统的BIO

BIO（Blocking I/O）即同步阻塞I/O，在NIO出现之前主要使用BIO及新建线程的方式来解决并发请求，但这样很容易因线程瓶颈而造成限制。

之所已使用多线程，因为accept()、read()、write()三个函数都是同步阻塞的，当一个连接存在的时候，系统是阻塞的，所以利用多线程让cpu处理更多的申请。多线程的本质：

- 利用cpu的多核特性
- 当I/O阻塞系统，但cpu空闲的时候，可以利用多线程使用cpu资源
   现在的多线程一般都使用线程池，可以让线程的创建和回收成本相对较低。在活动连接数不是特别高（小于单机1000）的情况下，这种模型是比较不错的，可以让每一个连接专注于自己的I/O并且编程模型简单，也不用过多考虑系统的过载、限流等问题。线程池本身就是一个天然的漏斗，可以缓冲一些系统处理不了的连接或请求。但当处理百万级的连接时，使用这种模型肯定是不实际的，让cpu去创建这么多的线程是不可能的。



### NIO有什么

从JDK1.4开始，Java提供了一系列改进的输入/输出处理的新特性，被统称为NIO(即New I/O)。新增了许多用于处理输入输出的类，这些类都被放在java.nio包及子包下，并且对原java.io包中的很多类进行改写，新增了满足NIO的功能。**NIO采用内存映射文件的方式来处理输入输出，NIO将文件或文件的一段区域映射到内存中，这样就可以像访问内存一样访问文件了。NIO与原来的IO有同样的作用和目的，但是使用的方式完全不同， NIO支持面向缓冲区(Buffer)的、基于通道(Channel)的IO操作。NIO将以更加高效的方式进行文件的读写操作。**
 NIO中的三个重要组件：

#### 1. 缓冲区Buffer

缓冲区有直接缓冲区和非直接缓冲区之分（关于两者的区别可以看[这里](https://blog.csdn.net/qiuwenjie123/article/details/79795699?utm_source=blogxgwz2)），它实际上也是一段内存空间。在NIO库中，所有数据都是用缓冲区处理的。在读取数据时，它是直接读到缓冲区中的； 在写入数据时，它也是写入到缓冲区中的。流程如下图：

![image-20200107112743557](https://gitee.com/sysker/picBed/raw/master/images/image-20200107112743557.png)

