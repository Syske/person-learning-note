# rocketMQ简单示例

## 前言

在微服务遍地开花的今天，消息队列的应用特别广泛，但在此之前，我对消息队列的认知仅仅停留在是什么和能干什么的认知，没有使用过任何一款消息队列，对它的实际应用也没有任何认知，但是从现在市场上的技术情况来说，消息队列已经是一个`web`后端开发必须掌握的核心组件之一，所以我就利用空闲时间来了解下，今天我们分享的是`rocketMQ`，同样也是阿里巴巴开源的一个组件，2016年阿里巴巴把它捐赠给了`Apache`开源基金会，目前是该基金会的顶级项目之一。



## 正文

在开始正文之前，我们先来看下消息队列的一些知识。

### 为什么需要消息队列

随着互联网业务需求的不断发展，传统的架构模式已经无法满足需求，特别是在电商业务大发展的当下更是如此。为了应对这种百万并发、千万并发甚至亿级数量的并发，这种并发模式的特点是并发量集中出现在某一时间段，比如双十一、双十二或者促销、打折日，而其他时间的并发量是峰值并发量的十分之一，甚至百分之一，如果按照峰值的并发量来设计系统架构，不仅初投资大耗费巨资，而且在日常运行维护也很烧钱。为了平衡这两种情况下的并发量，同时降低系统建设成本，消息队列这样的系统组件应运而生。

简单来说，消息队列就是一种平衡系统并发量的系统组件，主要的作用就是削峰填谷。我们假设这张图中红色表示没有加入消息队列组件的系统并发时序图（这里的图是随意画的，只是为了说明问题），蓝色表示架构中加入了消息队列组件：

![](https://gitee.com/sysker/picBed/raw/master/20210309225021.png)



对比之后我们会发现，我们发现引入消息队列组件之后，降低了订单系统的峰值并发量，就相当于我们将一部分峰值请求的业务处理，放在系统压力小时去处理，当然实际过程中订单系统一直在有条不紊地处理消息队列中的订单信息，直到所有订单处理完成。当然，它主要是针对一些实时性要求不强但并发量大的业务，比如购票、抢购下单等允许稍后推送处理结果的业务。

### 什么是消息队列

消息队列简单来讲，它就类似于存放消息的容器，消息生产者将消息放入消息队列中，消费者从消息队列中拿出消息进行消费（比如写订单）。消息队列是分布式系统中重要的组件，使用消息队列主要是为了通过异步处理提高系统性能和削峰、降低系统耦合性。目前使用较多的消息队列有`ActiveMQ`，`RabbitMQ`，`Kafka`，`RocketMQ`。这里我们再化一个图，补充说明下消息队列在系统架构中的位置，这里以购票为例：

![](https://gitee.com/sysker/picBed/raw/master/20210309231128.png)

没有引入消息队列的情况下，系统的响应时间是`150ms` + `150ms`，需要`300ms`，从业务流程上来说，订单受理成功后发送购票结果，这没有什么问题，但从用户体验的角度来讲，短信是否发送与用户提交订单的操作是没有关系的，也就是说用户需要知道的只是它的订单是否处理成功，至于是否购票成功的结果，我们可以异步的处理方式，这样可以减少用户等待的时间，提高服务的响应效率，如果省去短信系统的处理时间，那么最终业务的响应时间就缩减为`150ms`。

[^参考1]: https://www.jianshu.com/p/36a7775b04ec
[^参考2]: http://www.dockone.io/article/9726

